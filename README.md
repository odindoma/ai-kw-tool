# Система загрузки и анализа Excel файлов

Простой PHP сайт для загрузки Excel файлов и сохранения данных из вкладки "without ads" в MySQL базу данных.

## Функциональность

- Загрузка Excel файлов (.xlsx, .xls)
- Автоматическое извлечение данных из вкладки "without ads"
- Сохранение данных: Keyword, Yahoo Show Rate, Advertiser, Est. RPC $
- Автоматическое извлечение кода страны и типа ИИ-агента из имени файла
- Отображение таблицы загруженных файлов по типам ИИ-агентов на главной странице
- Просмотр результатов с фильтрацией
- Экспорт отфильтрованных результатов в Excel

## Требования

- PHP 7.4 или выше
- MySQL 5.7 или выше
- Composer
- Расширения PHP: pdo, pdo_mysql, zip, xml

## Установка

### 1. Подготовка файлов

Скопируйте все файлы проекта в директорию веб-сервера.

### 2. Установка зависимостей

```bash
composer install
```

### 3. Настройка базы данных

1. Создайте базу данных MySQL
2. Импортируйте структуру из файла `database.sql`:

```sql
mysql -u root -p < database.sql
```

**Для обновления существующей базы данных:**
Если у вас уже есть база данных от предыдущей версии, выполните:

```sql
mysql -u root -p < update_database.sql
```

### 4. Настройка конфигурации

Отредактируйте файл `config.php` и укажите параметры подключения к базе данных:

```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'excel_data_db');
define('DB_USER', 'your_username');
define('DB_PASS', 'your_password');
```

### 5. Настройка прав доступа

Убедитесь, что директория `uploads/` имеет права на запись:

```bash
chmod 755 uploads/
```

## Использование

### Загрузка файлов

1. Откройте `index.php` в браузере
2. Выберите Excel файл с вкладкой "without ads"
3. Нажмите "Загрузить файл"

### Просмотр результатов

1. Перейдите на страницу "Просмотр результатов" (`view.php`)
2. Используйте фильтры для поиска нужных данных:
   - По документу
   - По коду страны
   - По минимальному Est. RPC $
   - По минимальному Yahoo Show Rate %
3. Экспортируйте отфильтрованные результаты в Excel

## Структура файлов

```
excel_upload_site/
├── index.php              # Главная страница с формой загрузки
├── view.php               # Страница просмотра результатов
├── upload.php             # API для загрузки файлов
├── export.php             # Экспорт результатов в Excel
├── upload_handler.php     # Класс обработки загрузки
├── config.php             # Конфигурация
├── database.sql           # Структура базы данных
├── update_database.sql    # Скрипт обновления БД
├── styles.css             # Основные стили
├── view-styles.css        # Стили для страницы просмотра
├── script.js              # JavaScript для формы загрузки
├── composer.json          # Зависимости Composer
├── uploads/               # Директория для загруженных файлов
└── vendor/                # Зависимости (создается Composer)
```

## Структура базы данных

### Таблица `documents`
- `id` - ID документа
- `filename` - Имя сохраненного файла
- `original_filename` - Оригинальное имя файла
- `agent_type` - Тип ИИ-агента (извлекается из имени файла)
- `country_code` - Код страны (извлекается из имени файла)
- `upload_date` - Дата загрузки
- `records_count` - Количество записей

### Таблица `excel_data`
- `id` - ID записи
- `document_id` - Связь с документом
- `keyword` - Ключевое слово
- `yahoo_show_rate` - Yahoo Show Rate
- `advertiser` - Рекламодатель
- `est_rpc` - Estimated RPC
- `created_at` - Дата создания записи

## Формат входных файлов

Excel файлы должны содержать:
- Вкладку с названием "without ads"
- Колонки: Keyword, Yahoo, Yahoo Advertiser, Est. RPC $

Из имени файла автоматически извлекаются:
- Код страны по паттерну `-XX-` (например, UK из "Genspark1-UK-20250715120738.xlsx")
- Тип ИИ-агента - часть до первого дефиса (например, Genspark1 из "Genspark1-UK-20250715120738.xlsx")

На главной странице отображается таблица с группировкой загруженных файлов по типам ИИ-агентов и кодам стран.

## Поддержка

Для корректной работы убедитесь, что:
- Веб-сервер поддерживает PHP 7.4+
- MySQL сервер запущен и доступен
- Все зависимости установлены через Composer
- Права доступа к файлам настроены корректно

## Безопасность

- Файлы загружаются только в формате .xlsx и .xls
- Максимальный размер файла: 10MB
- Все пользовательские данные экранируются при выводе
- Используются подготовленные SQL запросы

